<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script type="text/javascript" src="./d3/d3.min.js"></script>

  <title>Dengue and Age in Lahore 2011-2012</title>

</head>

<body>
	<h2>Assignment 6: Bar Chart in D3.js</h2>
	<div class = "container">

		<div id = "chart"></div>

	</div>

	<script>
		var margin = 50; //define top, left, right and bottom margins in a dict
		var width = 600;
		var height = 450;

		//load the data

		d3.json("dengue_age.json", function(error, data) {

			data.forEach( function(d) {
				// unary+ operator to read numerical data correctly.
				d["01-10yrs."] = +d["01-10yrs."]
				d["11-20yrs."] = +d["11-20yrs."]
				d["21-30yrs."] = +d["21-30yrs."]
				d["31-40yrs."] = +d["31-40yrs."]
				d["41-50yrs."] = +d["41-50yrs."]
				d["51-60yrs."] = +d["51-60yrs."]
				d["61-70yrs."] = +d["61-70yrs."]
				d["71-80yrs."] = +d["71-80yrs."]
				d["81-90yrs."] = +d["81-90yrs."]
				d["91-100yrs."] = +d["91-100yrs."]
				d["Unknown"] = +d["Unknown"]
				d["Total"] = +d["Total"]
			});


			if (error) throw error;
			dataset = data;
			makeBarChart(dataset);
			console.log(dataset);
			//console.log(function (dataset) { return dataset["91-100yrs."]});
			
		});

		function makeBarChart(dataset) {

			var series = d3.stack()
		    .keys("01-10yrs.", "11-20yrs.", "21-30yrs.", "31-40yrs.", "41-50yrs.", "51-60yrs.", "61-70yrs.", "71-80yrs.",  "81-90yrs.", "91-100yrs."])
		    .offset(d3.stackOffsetDiverging)
		    (data);

			var keys = dataset.columns;

			//add the SVG element

			var svg = d3.select("#chart")
			.append('svg') 
			.attr('width', width + margin*2)
			.attr('height', height + margin*2);

			// set the ranges of X and Y axes

			var xScale = d3.scaleBand()
			.domain(dataset.map(function (d) { return d["Towns name"]; }))
			.rangeRound([0, width])
			.paddingInner(0.1)
    		.align(0.9);

			var yScale = d3.scaleLinear()
			.domain([d3.min(dataset, function (d) { return d["91-100yrs."]; }), 
				d3.max(dataset, function (d) { return d["21-30yrs."];	})])
			.range([height, 0])
			.nice();
			
			svg.append('g')
			.attr('transform', 'translate(' + margin + ',' + (height + margin) + ')')
			.call(d3.axisBottom(xScale));

			svg.append('g')
				.attr('transform', 'translate(' + margin + ',' + margin + ')')
			.call(d3.axisLeft(yScale));

			// add the data to the bar	chart		

			var g = svg.append('g')
			.attr('transform', 'translate(' + margin + ',' + margin + ')');
			//translate x and y where both of them are 25 right now

			barchart = g.selectAll(".barchart")
				.append("g")
				.data(dataset) // institutes a loop, 
				.enter() // important when the data viz is moving/changing
				.append("rect")
				.attr("class", "barchart") // now you're making sure that the class that you're choosing is barchart
				//.attr("x", )
				//.attr("y", )
				.attr("x", function(d) { return xScale(d["Towns name"]); })
				.attr("width", "30")
      			.attr("y", function(d) { return yScale(d["21-30yrs."]); })
      			.attr("height", function(d) { return height - yScale(d["21-30yrs."]); });

			// define the axes

		};

		
	</script>
</body>
</html>